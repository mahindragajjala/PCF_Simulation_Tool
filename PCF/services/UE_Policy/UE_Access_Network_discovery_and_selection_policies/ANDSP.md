The UE policy consists of
UE Access Network discovery and selection policies (ANDSP). It is used by the UE for selecting non-3GPP accesses network. 
The encoding of ANDSP is defined in 3GPP TS 24.526 [16];
UE Route Selection Policy (URSP). This UE policy is used by the UE to determine how to route outgoing traffic. 
Traffic can be routed to an established PDU Session, can be offloaded to non-3GPP access outside a PDU Session, or can trigger the establishment of a new PDU Session. The encoding of URSP is defined in 3GPP TS 24.526 [16]
UE Vehicle-to-Everything Policy (V2XP). This UE policy provides configuration parameters to the UE for V2X communication over PC5 reference point or over Uu reference point or both. The encoding of V2XP is defined in 3GPP TS 24.588 [25].

The UE Policy is transferred to the UE using the UE policy delivery protocol defined in Annex D of
3GPP TS 24.501 [15]. The (V-)(H-)PCF shall send UE policy using the "MANAGE UE POLICY COMMAND"
message and will receive the "MANAGE UE POLICY COMPLETE"or the "MANAGE UE POLICY COMMAND
REJECT" messages in the response. Those messages are transparently forwarded by the AMF.
The (V-)PCF shall use the Namf_Communication_N1N2MessageTransfer service operation defined in
subclause 5.2.2.3.1 of 3GPP TS 29.518 [14] to send MANAGE UE POLICY COMMAND" messages to the UE and
use the Namf_Communication_N1MessageNotify service operation defined in subclause 5.2.2.3.5 of
3GPP TS 29.518 [14] to receive "MANAGE UE POLICY COMPLETE" and "MANAGE UE POLICY COMMAND
REJECT" messages from the UE. The (V-)PCF shall only send "MANAGE UE POLICY COMMAND" messages
below a predefined size limit.
The H-PCF shall use service operations as defined in the present specification to receive "MANAGE UE POLICY
COMPLETE" and "MANAGE UE POLICY COMMAND REJECT" messages from the V-PCF and to send MANAGE
UE POLICY COMMAND" messages to the V-PCF. The H-PCF shall encode the "MANAGE UE POLICY
COMMAND" message in an "uePolicy" attribute. The H-PCF shall only send "MANAGE UE POLICY COMMAND"
messages below a predefined size limit.
The (V-)(H-)PCF may deliver the UE policy to the UE in several "MANAGE UE POLICY COMMAND" messages.
For the purpose of such fragmented delivery and subsequent partial updates of UE policies, the UE policy is divided
into policy sections. Such policy sections may be predefined in the (V-)(H-)PCF, may be retrieved by the (V-)(H-)PCFfrom the UDR as specified in 3GPP TS 29.519 [17], or may be dynamically generated by the (V-)(H-)PCF, but shall
comply to the rules below. The (V-)(H-)PCF may combine several policy sections into one "MANAGE UE POLICY
COMMAND" message if the predefined size limit is observed.
The following rules apply for policy sections:
- The size shall be below the predefined size limit.
- The policy section shall only contain complete URSP rule(s), WLANSP rule(s), N3AN node configuration
information, and/or complete V2XP info content, but no fractions of such rules , configuration information, or
info contents.
- To ease a subsequent partial update of UE policies, policy sections should only contain a small number of
policies, e.g. URSP rule(s), and/or WLANSP rule(s).
- The entire content of a policy section shall be provided by a single PLMN.
A PCF shall only determine policy sections of its own PLMN. However, a V-PCF may forward UE policy sections
received from the H-PCF to the UE.
Each UE policy section is identified by a UE policy section identifier (UPSI). The UPSI is composed of two parts:
a) a PLMN ID part containing the PLMN ID for the PLMN of the PCF which provides the UE policies; and
b) a UE policy section code (UPSC) containing a unique value within the PLMN selected by the PCF.
The (V-)(H-)PCF provides an UPSI when providing a new UE policy section and may then identify that policy section
using that UPSI when requesting that this UE policy section is modified or deleted, as specified in Annex D of
3GPP TS 24.501 [15].
If the (V-)(H-)PCF determines that changes are required and/or the V-PCF receives possible new or modified policy
sections determined by the H-PCF in the roaming case, it shall send the determined new, updated or deleted policy
sections using one or several "MANAGE UE POLICY COMMAND" messages towards the NF service consumer. In
the roaming case, the V-PCF may either combine policy sections received from the H-PCF and policy sections the VPCF selected in the same "MANAGE UE POLICY COMMAND" (as long as the predefined size limit is observed), or
use separate "MANAGE UE POLICY COMMAND" messages; however, the V-PCF shall not distribute the policy
sections received in one "MANAGE UE POLICY COMMAND" from the H-PCF into several "MANAGE UE POLICY
COMMAND" messages as long as the predefined size limit is observed for the policy sections received from the HPCF. The V-PCF shall allocate a new PTI for the "MANAGE UE POLICY COMMAND" sent by the V-PCF and store
the mapping between the new PTI and the PTI within the "MANAGE UE POLICY COMMAND" received from the HPCF.
After sending a "MANAGE UE POLICY COMMAND" messages, the (V-)(H-)PCF shall wait for a related
confirmation in a "MANAGE UE POLICY COMPLETE" messages or failure indication in a "MANAGE UE POLICY
COMMAND REJECT" message. When receiving no such message until the expiry of a supervision timer specified in
Annex D of 3GPP TS 24.501 [15], or when receiving a failure indication, the PCF should re-send related instructions
for the policy sections. In the roaming case, the H-PCF and the V-PCF shall each be responsible for resending those
policy sections that it originally supplied. In the case that the V-PCF combined policy sections received from the H-PCF
and policy sections the V-PCF selected in the same "MANAGE UE POLICY COMMAND" described below, the VPCF shall wait for the H-PCF to resend the policy sections of HPLMN, and then resend the combined policy sections.
The (V-)(H-)PCF shall always include the initially supplied policy sections when resending the UE policy.
The (V-)(H-)PCF shall determine that a received "MANAGE UE POLICY COMPLETE" message or "MANAGE UE
POLICY COMMAND REJECT" message is related to the result of a "MANAGE UE POLICY COMMAND" based on
the PTI within that message. In the roaming case, the V-PCF shall determine that the received message is related to the
result of the UE policy provided by the H-PCF if the PTI within the message belongs to one of the stored PTI mapping.
If the V-PCF combined policy sections received from the H-PCF and policy sections the V-PCF selected in the same
"MANAGE UE POLICY COMMAND", upon reception of a "MANAGE UE POLICY COMPLETE" message or
"MANAGE UE POLICY COMMAND REJECT" message the V-PCF shall:
- forward the corresponding "MANAGE UE POLICY COMPLETE" message to the H-PCF;- if a "MANAGE UE POLICY COMMAND REJECT" message with UPSI(s) of the HPLMN is received, forward
the parts of the "MANAGE UE POLICY COMMAND REJECT" message that relate to the UPSI(s) of the
HPLMN to the H-PCF;
- if a "MANAGE UE POLICY COMMAND REJECT" message without UPSI(s) of the HPLMN is received, send
a "MANAGE UE POLICY COMPLETE" message to the H-PCF; and
- provide the stored PTI received from the HPLMN in the corresponding "MANAGE UE POLICY COMMAND"
within the "MANAGE UE POLICY COMPLETE" message or "MANAGE UE POLICY COMMAND
REJECT" message towards the H-PCF.
If the V-PCF sent a separate "MANAGE UE POLICY COMMAND" containing only the policy sections received from
the H-PCF, the V-PCF shall forward the corresponding "MANAGE UE POLICY COMPLETE" or "MANAGE UE
POLICY COMMAND REJECT" message to the H-PCF and provide the stored PTI received from the HPLMN in the
corresponding "MANAGE UE POLICY COMMAND" within the "MANAGE UE POLICY COMPLETE" message or
"MANAGE UE POLICY COMMAND REJECT" message towards the H-PCF.If the V-PCF distributed the policy
sections received in one "MANAGE UE POLICY COMMAND" from the H-PCF into several "MANAGE UE POLICY
COMMAND" messages to the UE (because the predefined size limit of the VPLMN was exceeded), the V-PCF shall
aggregate all corresponding "MANAGE UE POLICY COMPLETE" or "MANAGE UE POLICY COMMAND
REJECT" messages received from the UE into one "MANAGE UE POLICY COMPLETE" or "MANAGE UE
POLICY COMMAND REJECT" message towards the H-PCF.
When the (V-)PCF receives an Namf_Communication_N1N2MessageTransfer failure response as defined in
subclause 5.2.2.3.1.2 of 3GPP TS 29.518 [14], or an N1N2 Transfer Failure Notification as defined in subclause
5.2.2.3.2 of 3GPP TS 29.518 [14], the (V-)PCF shall stop the supervision timer specified in Annex D of
3GPP TS 24.501 [15] corresponding to the affected PTIs. For the N1N2 Transfer Failure Notification case, the (V-)PCF
determines the affected PTIs allocated by the V-PCF based on the resource URI within the "n1n2MsgDataUri" attribute
of the N1N2MsgTxfrFailureNotification data structure as defined in subclause 6.1.6.2.30 of 3GPP TS 29.518 [14].
NOTE: The (V-)PCF correlates the Namf_Communication_N1N2MessageTransfer request and the corresponding
N1N2 Transfer Failure Notification based on the resource URI within the "Location" header included in
the response HTTP status code "202 Accepted" of the Namf_Communication_N1N2MessageTransfer
response and the resource URI within the "n1n2MsgDataUri" attribute of and N1N2 Transfer Failure
Notification. And then the V-PCF determines the affected PTIs related with the resource URI.
For the roaming case and if the V-PCF determines that the affected UE policy is related with the UE policy delivered by
the H-PCF, the V-PCF shall send the POST message as defined in subclause 4.2.3.1 to notify the H-PCF of the failure
of UE policy transfer by including the "uePolTransFailNotif" attribute within the PolicyAssociationUpdateRequest data
structure. Within the UePolicyTransferFailureNotification data structure, the V-PCF shall include the cause of the UE
Policy Transfer Failure within the "cause" attribute and the PTI(s) allocated by the H-PCF corresponding to the PTI(s)
allocated by the V-PCF within the "ptis" attribute. The H-PCF shall stop the supervision timer corresponding to the affected PTIs.

In the failure case described above, the (H-)(V-)PCF may provision the policy control request trigger "CON_STATE_CH" if not provisioned yet. Upon receiving the notification of UE connectivity state change indicating that the UE enters the CM-Connected state, the (H-)(V-)PCF may retry to deliver the UE Policy.


Here's a simplified breakdown of the content:
UE Policy Delivery:
The (V-)PCF sends the UE policy to the User Equipment (UE) using the "MANAGE UE POLICY COMMAND" message.
The response can be "MANAGE UE POLICY COMPLETE" (successful) or "MANAGE UE POLICY COMMAND REJECT" (failure).
These messages are forwarded by the AMF (Access and Mobility Management Function).
PCF Communication:
The (V-)PCF uses service operations defined in 3GPP TS 29.518 for sending and receiving policy messages.
The PCF will send the "MANAGE UE POLICY COMMAND" to the UE, and the response is received using a service operation that returns either a complete message or a rejection message.
Size Limits for Messages:
"MANAGE UE POLICY COMMAND" messages must be below a predefined size limit.
If the policy data is large, it may be split into multiple messages.
Policy Sections:
UE policies are divided into "policy sections," which may be predefined or generated by the PCF.
A policy section contains complete rules (e.g., URSP, WLANSP) and configuration info, and must not be partial.
The policy sections should generally be small to ease updates and are identified by a unique identifier called UE Policy Section Identifier (UPSI).
Policy Section Handling:
The V-PCF (or H-PCF) can combine or split policy sections to send them to the UE.
When updates are required, the PCF sends the new or modified sections in one or more messages.
If the predefined size limit is exceeded, the PCF may split the policy sections across multiple messages.
Roaming Scenarios:
In roaming situations, the V-PCF and H-PCF may send combined or separate policy sections to the UE.
After sending a policy command, the PCF waits for a response (either complete or rejected).
If the response isn't received within the specified time, the PCF re-sends the instructions.
Failure Handling:
If a failure occurs (e.g., Namf_Communication_N1N2MessageTransfer failure), the PCF stops the supervision timer for affected PTIs (Policy Transfer Identifiers).
In the event of a failure, the PCF notifies the H-PCF and retries delivering the UE policy once the connectivity state is re-established.
PTI Mapping:
Each "MANAGE UE POLICY COMMAND" is assigned a unique PTI, which is tracked by the PCF to correlate commands and responses.
Failure Notifications:
If there's a failure during the policy transfer, the V-PCF sends a failure notification to the H-PCF, including the reason for failure and affected PTIs.
The H-PCF stops the supervision timer for the affected PTIs and may retry delivering the policy.
Retry Logic:
The PCF may retry delivering the policy if the UE enters the CM-Connected state, indicated by a state change notification.
In short, the process involves sending, receiving, and managing UE policies between the PCF and the UE, with specific rules for splitting, combining, and handling failures, especially in roaming scenarios.


The ANDSP is used to control the UE behaviour related to access network discovery and selection over non-3GPP access network.
The ANDSP consists of:
- WLAN Selection Policy (WLANSP) which is described in clause 4.3.2.; and
- non-3GPP access network (N3AN) node configuration information which is described in clause 4.3.3.

WLAN selection policy (WLANSP) - Wireless local area network selection policy

The WLANSP is used to control UE behaviour related to selection and reselection of a WLAN.
The WLANSP consists of zero or more WLANSP rules.

Each WLANSP rule consists of:
- rule identifier;
- one or more groups of WLAN selection criteria;
- validity area;
- zero or more time of day;
- rule priority;
- roaming.

Each group of WLAN selection criteria contains:
- criteria priority;
- home network indication;
- preferred roaming partner list;
- min backhaul threshold;
- maximum BSS load value;
- required proto port tuple;
- SP exclusion list; and
- preferred SSID list.

The priority of a selection criteria is encoded in the criteria priority field. 

The WLAN priority defined in the preferred SSID list (see figure 5.3.2.4c) represents the priority of the WLAN matching the selection criteria.

The validity of the WLANSP rule can be restricted by validity conditions. 

The validity of the WLANSP rule takes into account validity area, roaming, and time of day where each condition shall match in order to make the WLANSP rule valid.

Each validity area consists of:
- 3GPP location;
- WLAN location;
- Geo location.

Each time of day consists of:
- time start;
- time stop;
- date start;
- date stop; 
- day of week.

The WLANSP rule is considered valid if none of the validity conditions exist or all validity conditions match.

There can be multiple valid WLANSP rules at the same time. 

In addition to validity conditions and selection criteria, there is a rule priority that shall be set for each WLANSP rule. 

The rule priority is encoded in the rule priority field, and it enables the UE to determine which WLANSP rule, out of potentially several valid WLANSP rules, it should consider
as active. 

A WLANSP rule is active if it is valid and has highest rule priority out of the valid WLANSP rules. 

At any point in time, there shall be at most one active WLANSP rule. A WLAN that matches a selection criteria of the active WLANSP rule is considered as matching the selection criteria.

If the UE is roaming and WLANSP rules from both HPLMN and VPLMN are available, visited WLANSP rules shall take precedence.



WLAN access selection

The procedure of UE selecting WLAN access network based on WLAN selection policy is specified in 3GPP TS 24.502 [3].

The 5G-RG and the W-AGF acting on behalf of an FN-RG shall ignore the WLAN selection policy, if received.


